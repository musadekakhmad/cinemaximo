<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cinemaximo - Your Ultimate Destination for Free HD Movie Streaming</title>
    <!-- Favicon: Using an SVG emoji for efficiency and relevance -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🎬</text></svg>">
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom CSS for rainbow text in the header */
        .rainbow-text-header {
            background-image: linear-gradient(to right, violet, indigo, blue, green, yellow, orange, red);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 800;
        }
        /* CSS for making the header sticky */
        .sticky-header {
            position: sticky;
            top: 0;
            z-index: 50; /* Ensure the header stays on top of other content when scrolling */
        }
        /* Custom spinner for loading states */
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #3B82F6; /* Blue color */
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #2d3748; /* bg-gray-800 */
        }
        ::-webkit-scrollbar-thumb {
            background: #4a5568; /* bg-gray-600 */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280; /* bg-gray-500 */
        }
    </style>

    <!-- SEO Meta Tags -->
    <meta name="description" content="Welcome to Cinemaximo, the best free movie streaming platform online. Watch thousands of HD movies, from new releases to timeless classics, with no subscription required. Your ultimate source for unlimited entertainment.">
    <meta name="keywords" content="Cinemaximo, free movies, watch movies online, HD streaming, latest movies, popular movies, no subscription, free entertainment, online cinema, movie streaming site">
    <link rel="canonical" href="https://cinemaximo.netlify.app/">

    <!-- Open Graph & Twitter Meta Tags for social media sharing -->
    <meta property="og:title" content="Cinemaximo - Free HD Movie Streaming">
    <meta property="og:description" content="The best free movie streaming platform. Watch thousands of HD movies for free.">
    <meta property="og:image" content="https://live.staticflickr.com/65535/54700927490_c2f6a1865c_b.jpg">
    <meta property="og:url" content="https://cinemaximo.netlify.app/">
    <meta property="og:type" content="website">
    <meta property="fb:app_id" content="100074345305108">
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:site" content="@ErwizalA84074">
    <meta property="twitter:title" content="Cinemaximo - Free HD Movie Streaming">
    <meta property="twitter:description" content="The best free movie streaming platform. Watch thousands of HD movies for free.">

</head>
<body class="bg-gray-900 text-gray-200">
    <!-- Header and Navigation -->
    <header class="bg-gray-800 shadow-md sticky-header">
        <div class="container mx-auto px-4 max-w-7xl">
            <nav class="p-4 flex flex-col md:flex-row justify-between items-center">
                <a href="#" id="home-link" class="flex items-center mb-4 md:mb-0">
                    <!-- Movie Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-yellow-400 mr-3" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M18 3H6c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM6 5h12v14H6V5zm10 12h-2v-2h2v2zM8 7h2v2H8V7zm0 4h2v2H8v-2zm0 4h2v2H8v-2zm4-4h2v2h-2v-2zm0 4h2v2h-2v-2zm4-4h2v2h-2v-2z"/>
                    </svg>
                    <span class="rainbow-text-header text-3xl md:text-4xl">Cinemaximo</span>
                </a>
                <!-- Navigation links, dropdowns, and search bar -->
                <div class="flex items-center space-x-4">
                    <a href="#" class="text-white hover:text-red-500 hover:font-bold transition-colors duration-300">Home</a>
                    <div class="relative group">
                        <button id="movies-dropdown-button" class="text-white hover:text-blue-500 hover:font-bold transition-colors duration-300 flex items-center">
                            Movies
                            <svg class="h-4 w-4 ml-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        <div id="movies-dropdown-menu" class="absolute opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 bg-gray-700 text-white rounded-lg shadow-lg mt-2 py-2 z-10 w-48">
                            <button class="block w-full text-left px-4 py-2 hover:bg-gray-600" data-category="popular" data-type="movie">Popular</button>
                            <button class="block w-full text-left px-4 py-2 hover:bg-gray-600" data-category="now_playing" data-type="movie">Now Playing</button>
                            <button class="block w-full text-left px-4 py-2 hover:bg-gray-600" data-category="upcoming" data-type="movie">Upcoming</button>
                            <button class="block w-full text-left px-4 py-2 hover:bg-gray-600" data-category="top_rated" data-type="movie">Top Rated</button>
                        </div>
                    </div>
                    <div class="relative group">
                        <button id="tv-shows-dropdown-button" class="text-white hover:text-yellow-400 transition-colors duration-300 flex items-center">
                            Tv Shows
                            <svg class="h-4 w-4 ml-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        <div id="tv-shows-dropdown-menu" class="absolute opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 bg-gray-700 text-white rounded-lg shadow-lg mt-2 py-2 z-10 w-48">
                            <button class="block w-full text-left px-4 py-2 hover:bg-gray-600" data-category="popular" data-type="tv">Popular</button>
                            <button class="block w-full text-left px-4 py-2 hover:bg-gray-600" data-category="airing_today" data-type="tv">Airing Today</button>
                            <button class="block w-full text-left px-4 py-2 hover:bg-gray-600" data-category="on_the_air" data-type="tv">On TV</button>
                            <button class="block w-full text-left px-4 py-2 hover:bg-gray-600" data-category="top_rated" data-type="tv">Top Rated</button>
                        </div>
                    </div>
                    <!-- Search Form -->
                    <form id="search-form" class="flex items-center">
                        <input type="text" id="search-input" placeholder="Search movies or TV shows..." class="px-3 py-1 text-sm rounded-l-full bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 w-40 md:w-auto">
                        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-r-full shadow-lg transition-colors duration-300">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                            </svg>
                        </button>
                    </form>
                </div>
            </nav>
        </div>
    </header>

    <!-- Main Content Area -->
    <main id="main-content" class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Main Banner Image -->
        <div id="hero-section" class="mb-8 rounded-lg overflow-hidden shadow-lg">
            <img src="https://live.staticflickr.com/65535/54700927490_c2f6a1865c_b.jpg" alt="Cinemaximo Movie Streaming Banner" class="w-full h-auto">
        </div>

        <!-- Main Heading -->
        <h1 id="main-heading" class="text-3xl md:text-4xl font-extrabold text-white mb-6 leading-tight flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-yellow-400 mr-4 flex-shrink-0" viewBox="0 0 24 24" fill="currentColor">
                <path d="M18 3H6c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM6 5h12v14H6V5zm10 12h-2v-2h2v2zM8 7h2v2H8V7zm0 4h2v2H8v-2zm0 4h2v2H8v-2zm4-4h2v2h-2v-2zm0 4h2v2h-2v-2zm4-4h2v2h-2v-2z"/>
            </svg>
            Welcome to Cinemaximo: Your Ultimate Destination for the Best Free Movie Streaming
        </h1>

        <!-- Introduction Section -->
        <p id="intro-section" class="text-lg mb-8 text-gray-300 text-justify">
            Welcome to Cinemaximo, a revolutionary platform designed specifically for cinema lovers seeking a high-quality movie watching experience at no cost. In today's digital age, where entertainment is an inseparable part of daily life, Cinemaximo serves as an advanced solution to meet your needs. We understand how valuable your free time is, and we are committed to providing unlimited access to thousands of films across various genres, from the latest Hollywood blockbusters to timeless classics. With a constantly updated collection and a user-friendly interface, Cinemaximo is not just a streaming site but a community for those passionate about the seventh art.
        </p>
        
        <!-- Placeholder for dynamic content -->
        <div id="content-area"></div>
    </main>

    <!-- Dedicated Streaming Page View -->
    <!-- Added pt-20 to push content down and clear the sticky header -->
    <div id="streaming-page-view" class="hidden w-full min-h-screen bg-gray-900 absolute top-0 left-0 z-40 overflow-y-auto p-4 pt-20">
        <div class="container mx-auto px-4 py-8 max-w-7xl">
            <!-- Back button for the streaming view -->
            <button id="streaming-back-button" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-full transition-colors duration-300 mb-6 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                </svg>
                Back to Details
            </button>

            <!-- Streaming player and controls -->
            <h3 id="streaming-page-title" class="text-xl md:text-2xl font-bold text-white mb-4 text-center"></h3>
            <div class="relative w-full h-0 pb-[56.25%] rounded-lg overflow-hidden mb-4">
                <iframe id="streaming-player-inline" class="absolute top-0 left-0 w-full h-full" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
            <div class="flex justify-center space-x-4 mb-4">
                <button id="stream-1-inline-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-full transition-colors duration-300 shadow-lg">Stream 1</button>
                <button id="stream-2-inline-button" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-full transition-colors duration-300 shadow-lg">Stream 2</button>
            </div>
            <div class="mt-4 text-center text-sm text-gray-400 space-y-2">
                <p>Please wait for the player to display the film (maximum 1 minute).</p>
                <p>Film availability depends on the third party.</p>
                <p>Enjoy the show! Share this web link if you like it!</p>
            </div>

            <!-- "Some people like this" section within the streaming view -->
            <div class="mt-[0.7cm] text-center">
                <h4 class="text-lg font-bold text-white mb-4">Some people like this</h4>
                <!-- Changed to grid layout for normal display -->
                <div id="inline-similar-container" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4">
                    <!-- Film cards will be inserted here dynamically -->
                </div>
            </div>
        </div>
    </div>


    <!-- Footer Section -->
    <footer class="bg-gray-800 text-center text-gray-400 p-4 mt-12">
        <p>&copy; 2024 Cinemaximo. All rights reserved.</p>
    </footer>

    <script>
        // Mendefinisikan variabel global untuk tautan iklan dari config.js
        // Pastikan file config.js dimuat sebelum script ini
        window.ADSTERRA_DIRECT_LINKS = [
            'https://discreetisabella.com/g77bpz0g?key=f1cc7147d1c59d932b6186896ab8854c',
            'https://discreetisabella.com/vttzzi1n?key=bfc8d7d57de835830a0d72fbe7a47be1',
            'https://discreetisabella.com/y5fc24f7?key=d6efa8068c5da148ed5cf346ffa62290',
            'https://discreetisabella.com/a43vczjf1b?key=70467091cade36a7f916bfe58dc80cff',
            'https://discreetisabella.com/t71keggw?key=9c6906c82c8eb114e2baef9058f4c4e5',
            'https://discreetisabella.com/vb5ixea83?key=c4e7438c85503eda026984db5e7aa3c4',              
            'https://discreetisabella.com/x818nj48?key=db0a9d9fa9d81626b459383a7bdc33ee',
            'https://discreetisabella.com/gd8bwkyj?key=d2d35cf16f521bf5e9accfdd865dae8f',
            'https://discreetisabella.com/paij3re0by?key=fa60f72b73c05d987bd978f83a6deaa8',
            'https://discreetisabella.com/gh4tkda15?key=080742d09d4b5234a4fdaa773e48ebd4',
            'https://discreetisabella.com/u1ipxidjif?key=bf544685cc418fde38d3de4391de6fee',
            'https://discreetisabella.com/nu4ravi1cx?key=4d0556009c2d17968977e235d5de925a',
            'https://discreetisabella.com/wdhedf2wx?key=a2c98838af4390b59e8b7aaaea3f1660',
            'https://discreetisabella.com/yed8kj7bvw?key=b7830767455354f8e097df2a9e0f040c',
            'https://discreetisabella.com/w2sw8zgx21?key=d34ca1378210247721e98e65d20b3693',
            'https://discreetisabella.com/qn92sfcb?key=a8333f15c6bba15e367a5456f691547c',
            'https://discreetisabella.com/rz2xzbfm?key=8c4045c97068010d84c3f1002e82b1c9'
        ];

        document.addEventListener('DOMContentLoaded', () => {
            // #############################################
            // API KEY CONFIGURATION (UPDATED)
            // #############################################
            // A list of available API keys/proxies. The application will try the first one,
            // and if it fails, it will fall back to the next one.
            const apiKeys = [
                'tmdb-api-proxy.argoyuwono119.workers.dev',
                'tmdb-api-proxy.musadekakhmad.workers.dev',
                'tmdb-api-proxy-1.musadekakhmad.workers.dev'
            ];
            
            // #############################################
            // ADSTERRA INTEGRATION (NEW)
            // #############################################
            let clickCounter = 0; // Global click counter

            const openAdsterraLink = () => {
                if (window.ADSTERRA_DIRECT_LINKS && window.ADSTERRA_DIRECT_LINKS.length > 0) {
                    const randomIndex = Math.floor(Math.random() * window.ADSTERRA_DIRECT_LINKS.length);
                    const adLink = window.ADSTERRA_DIRECT_LINKS[randomIndex];
                    window.open(adLink, '_blank');
                    console.log('Adsterra link opened:', adLink); // For debugging
                } else {
                    console.warn('ADSTERRA_DIRECT_LINKS is not defined or empty.');
                }
            };

            // Event listener for all clicks on the body
            document.body.addEventListener('click', () => {
                clickCounter++;
                // Trigger on 2nd click, then every 7 clicks (9th, 16th, 23rd, etc.)
                if (clickCounter === 2 || (clickCounter > 2 && (clickCounter - 2) % 7 === 0)) {
                    openAdsterraLink();
                }
            });


            // #############################################
            // CENTRALIZED STATE MANAGEMENT
            // #############################################

            const contentArea = document.getElementById('content-area');
            const heroSection = document.getElementById('hero-section');
            const introSection = document.getElementById('intro-section');
            const mainHeading = document.getElementById('main-heading');
            const searchForm = document.getElementById('search-form');
            const searchInput = document.getElementById('search-input');
            const homeLink = document.getElementById('home-link');
            
            // New elements for the dedicated streaming view
            const streamingPageView = document.getElementById('streaming-page-view');
            const streamingPageTitle = document.getElementById('streaming-page-title');
            const streamingPlayerInline = document.getElementById('streaming-player-inline');
            const stream1InlineButton = document.getElementById('stream-1-inline-button');
            const stream2InlineButton = document.getElementById('stream-2-inline-button');
            const inlineSimilarContainer = document.getElementById('inline-similar-container');
            const streamingBackButton = document.getElementById('streaming-back-button');

            // Dropdown menu elements
            const moviesDropdownButton = document.getElementById('movies-dropdown-button');
            const moviesDropdownMenu = document.getElementById('movies-dropdown-menu');
            const tvShowsDropdownButton = document.getElementById('tv-shows-dropdown-button');
            const tvShowsDropdownMenu = document.getElementById('tv-shows-dropdown-menu');


            const state = {
                currentPage: 1,
                renderedItemIds: new Set(),
                currentView: 'home', // 'home', 'list', 'details', 'search', 'streaming'
                listParams: null, // { fetchType, type, id, title }
                detailsParams: null, // { type, id, title }
                searchQuery: null,
                currentTrailerKey: null,
                currentMediaId: null, // Menyimpan ID media saat ini
                currentMediaType: null // Menyimpan tipe media saat ini
            };

            const updateState = (newState) => {
                Object.assign(state, newState);
                render();
            };

            const render = () => {
                // Sembunyikan tampilan halaman streaming terlebih dahulu
                streamingPageView.classList.add('hidden');
                document.getElementById('main-content').classList.remove('hidden'); // Pastikan main content selalu terlihat

                // Sembunyikan elemen-elemen utama di dalam main-content secara default
                heroSection.classList.add('hidden');
                introSection.classList.add('hidden');
                mainHeading.classList.add('hidden');
                contentArea.innerHTML = ''; // Clear contentArea at the start of render for safety
                state.renderedItemIds.clear();

                // Scroll to top on view change
                window.scrollTo({ top: 0, behavior: 'smooth' });

                switch (state.currentView) {
                    case 'home':
                        heroSection.classList.remove('hidden');
                        introSection.classList.remove('hidden');
                        mainHeading.classList.remove('hidden');
                        mainHeading.innerHTML = `
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-yellow-400 mr-4 flex-shrink-0" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M18 3H6c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM6 5h12v14H6V5zm10 12h-2v-2h2v2zM8 7h2v2H8V7zm0 4h2v2H8v-2zm0 4h2v2H8v-2zm4-4h2v2h-2v-2zm0 4h2v2h-2v-2zm4-4h2v2h-2v-2z"/>
                            </svg>
                            Welcome to Cinemaximo: Your Ultimate Destination for the Best Free Movie Streaming
                        `;
                        // contentArea will be empty for home, as dynamic content is not loaded initially
                        break;
                    case 'list':
                        mainHeading.classList.remove('hidden'); // Ensure main heading is visible for lists
                        showDynamicContent(state.listParams.fetchType, state.listParams.type, state.listParams.id, state.listParams.title);
                        break;
                    case 'details':
                        // mainHeading is intentionally hidden for details view to give more space for movie info
                        showDetails(state.detailsParams.type, state.detailsParams.id, state.detailsParams.title);
                        break;
                    case 'search':
                        mainHeading.classList.remove('hidden'); // Ensure main heading is visible for search
                        showSearchResults(state.searchQuery);
                        break;
                    case 'streaming':
                        document.getElementById('main-content').classList.add('hidden'); // Sembunyikan main content ketika streaming
                        streamingPageView.classList.remove('hidden');
                        // Konten untuk streamingPageView diisi saat tombol 'Stream Now' diklik
                        break;
                }
            };
            
            // #############################################
            // UTILITY FUNCTIONS & API CALLS
            // #############################################
            // Function to perform a fetch with fallback and exponential backoff if an API key fails
            const safeFetch = async (urlSuffix, options = {}, retries = 3, delay = 1000) => {
                for (let i = 0; i < apiKeys.length; i++) {
                    const apiKey = apiKeys[i];
                    const url = `https://${apiKey}${urlSuffix}`;
                    for (let j = 0; j < retries; j++) {
                        try {
                            const response = await fetch(url, options);
                            if (response.ok) {
                                return response.json();
                            } else if (response.status === 429 || response.status >= 500) {
                                // Too Many Requests or Server Error, retry with backoff
                                console.warn(`API key ${apiKey} failed with status ${response.status}. Retrying in ${delay}ms...`);
                                await new Promise(res => setTimeout(res, delay));
                                delay *= 2; // Exponential backoff
                            } else {
                                // Other client-side errors, don't retry with current API key
                                console.error(`API key ${apiKey} failed with status ${response.status}: ${response.statusText}`);
                                break; // Break from inner retry loop, try next API key
                            }
                        } catch (error) {
                            console.warn(`Failed to fetch from ${apiKey}. Retrying in ${delay}ms...`, error);
                            await new Promise(res => setTimeout(res, delay));
                            delay *= 2; // Exponential backoff
                        }
                    }
                }
                throw new Error('All API keys failed to fetch data after multiple retries.');
            };

            const fetchContent = async (type, category, page = 1) => {
                const urlSuffix = `/${type}/${category}?page=${page}`;
                try {
                    const data = await safeFetch(urlSuffix);
                    return data.results;
                } catch (error) {
                    console.error('Error fetching data:', error);
                    return [];
                }
            };
            
            const fetchByGenre = async (type, genreId, page = 1) => {
                const urlSuffix = `/discover/${type}?with_genres=${genreId}&page=${page}`;
                try {
                    const data = await safeFetch(urlSuffix);
                    return data.results;
                } catch (error) {
                    console.error('Error fetching data by genre:', error);
                    return [];
                }
            };

            const fetchSearchResults = async (query) => {
                const urlSuffix = `/search/multi?query=${encodeURIComponent(query)}`;
                try {
                    const data = await safeFetch(urlSuffix);
                    return data.results;
                } catch (error) {
                    console.error('Error fetching search results:', error);
                    return [];
                }
            };

            const renderCards = (items, container, limit = null) => {
                const itemsToRender = limit ? items.slice(0, limit) : items;

                itemsToRender.forEach(item => {
                    const mediaType = item.media_type || (item.title ? 'movie' : 'tv');

                    if (state.renderedItemIds.has(item.id) || (mediaType !== 'movie' && mediaType !== 'tv')) {
                        return;
                    }
                    state.renderedItemIds.add(item.id);

                    const title = item.title || item.name;
                    const posterPath = item.poster_path;
                    const posterUrl = posterPath ? `https://image.tmdb.org/t/p/w500/${posterPath}` : 'https://placehold.co/500x750?text=No+Image';

                    const card = document.createElement('div');
                    card.className = 'bg-gray-800 rounded-lg shadow-md overflow-hidden transform hover:scale-105 transition-transform duration-300 cursor-pointer';
                    card.innerHTML = `
                        <img src="${posterUrl}" alt="Poster for ${title}" class="w-full h-auto object-cover">
                        <div class="p-4">
                            <h4 class="text-xl font-bold text-white truncate">${title}</h4>
                            <p class="text-sm text-gray-400 mt-1">Rating: ${item.vote_average ? item.vote_average.toFixed(1) : 'N/A'}</p>
                        </div>
                    `;

                    // Update the click handler to include the movie title in the hash
                    card.addEventListener('click', () => {
                        window.location.hash = `details/${mediaType}/${item.id}/${encodeURIComponent(title)}`;
                    });

                    container.appendChild(card);
                });
            };

            const renderSimpleCards = (items, container, limit = null) => {
                const itemsToRender = limit ? items.slice(0, limit) : items;
                container.innerHTML = ''; // Clear previous content

                itemsToRender.forEach(item => {
                    const mediaType = item.media_type || (item.title ? 'movie' : 'tv');
                    const title = item.title || item.name;
                    const posterPath = item.poster_path;
                    const posterUrl = posterPath ? `https://image.tmdb.org/t/p/w200/${posterPath}` : 'https://placehold.co/200x300?text=No+Image';

                    const card = document.createElement('div');
                    // Removed fixed width and flex-shrink-0 for grid layout
                    card.className = 'bg-gray-800 rounded-lg shadow-md overflow-hidden transform hover:scale-105 transition-transform duration-300 cursor-pointer';
                    card.innerHTML = `
                        <img src="${posterUrl}" alt="Poster for ${title}" class="w-full h-auto object-cover">
                        <div class="p-2">
                            <h4 class="text-sm font-bold text-white truncate">${title}</h4>
                        </div>
                    `;
                    card.addEventListener('click', () => {
                        window.location.hash = `details/${mediaType}/${item.id}/${encodeURIComponent(title)}`;
                        // Ketika mengklik film serupa di tampilan streaming, kembali ke detail dan kemudian muat film itu
                        // Ini akan memicu handleUrlHash dan kemudian showDetails untuk film baru
                        streamingPlayerInline.src = ''; // Hentikan video saat ini
                        updateState({ currentView: 'details', detailsParams: { type: mediaType, id: item.id, title: title } });
                    });
                    container.appendChild(card);
                });
            };

            const showDynamicContent = async (fetchType, type, id, title) => {
                contentArea.innerHTML = ''; // Clear content area before populating
                mainHeading.innerHTML = `<h2 class="text-3xl md:text-4xl font-extrabold text-white mb-6">${title}</h2>`;
                mainHeading.classList.remove('hidden'); // Pastikan judul terlihat

                const loadingSpinner = document.createElement('div');
                loadingSpinner.className = 'flex justify-center items-center h-64';
                loadingSpinner.innerHTML = `<div class="loading-spinner"></div>`;
                contentArea.appendChild(loadingSpinner);

                const itemsContainer = document.createElement('div');
                itemsContainer.className = 'grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6';
                
                let items;
                try {
                    if (fetchType === 'category') {
                        items = await fetchContent(type, id, state.currentPage);
                    } else if (fetchType === 'genre') {
                        items = await fetchByGenre(type, id, state.currentPage);
                    }
                } catch (error) {
                    console.error('Error fetching dynamic content:', error);
                    items = [];
                } finally {
                    loadingSpinner.remove();
                }

                if (items && items.length > 0) {
                    contentArea.appendChild(itemsContainer);
                    renderCards(items, itemsContainer);

                    const loadMoreButton = document.createElement('button');
                    loadMoreButton.className = 'mt-8 mx-auto block bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-transform duration-300 transform hover:scale-105';
                    loadMoreButton.textContent = 'Load More';
                    
                    loadMoreButton.addEventListener('click', async () => {
                        loadMoreButton.disabled = true; // Disable button while loading
                        loadMoreButton.textContent = 'Loading...';

                        updateState({ currentPage: state.currentPage + 1 });
                        let moreItems;
                        try {
                            if (fetchType === 'category') {
                                moreItems = await fetchContent(type, id, state.currentPage);
                            } else if (fetchType === 'genre') {
                                moreItems = await fetchByGenre(type, id, state.currentPage);
                            }
                        } catch (error) {
                            console.error('Error fetching more items:', error);
                            moreItems = [];
                        } finally {
                            loadMoreButton.disabled = false; // Re-enable button
                            loadMoreButton.textContent = 'Load More';
                        }

                        if (moreItems && moreItems.length > 0) {
                            renderCards(moreItems, itemsContainer);
                        } else {
                            loadMoreButton.textContent = 'No More Items';
                            loadMoreButton.disabled = true;
                        }
                    });
                    contentArea.appendChild(loadMoreButton);
                } else {
                    contentArea.innerHTML = '<p class="text-center text-gray-500">No content found for this category/genre.</p>';
                }
            };

            const showSearchResults = async (query) => {
                contentArea.innerHTML = ''; // Clear content area before populating
                mainHeading.innerHTML = `<h2 class="text-3xl md:text-4xl font-extrabold text-white mb-6">Search Results for: "${decodeURIComponent(query)}"</h2>`;
                mainHeading.classList.remove('hidden'); // Pastikan judul terlihat

                const loadingSpinner = document.createElement('div');
                loadingSpinner.className = 'flex justify-center items-center h-64';
                loadingSpinner.innerHTML = `<div class="loading-spinner"></div>`;
                contentArea.appendChild(loadingSpinner);

                let searchResults;
                try {
                    searchResults = await fetchSearchResults(query);
                } catch (error) {
                    console.error('Error fetching search results:', error);
                    searchResults = [];
                } finally {
                    loadingSpinner.remove();
                }

                if (searchResults && searchResults.length > 0) {
                    const itemsContainer = document.createElement('div');
                    itemsContainer.className = 'grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6';
                    contentArea.appendChild(itemsContainer);
                    renderCards(searchResults, itemsContainer);
                } else {
                    contentArea.innerHTML = '<p class="text-center text-gray-500">No results found for your search.</p>';
                }
            };

            const showDetails = async (type, id, titleFromHash) => {
                contentArea.innerHTML = ''; // Clear content area before populating
                const loadingSpinner = document.createElement('div');
                loadingSpinner.className = 'flex justify-center items-center h-64';
                loadingSpinner.innerHTML = `<div class="loading-spinner"></div>`;
                contentArea.appendChild(loadingSpinner);

                try {
                    // Mengambil semua data yang diperlukan secara paralel
                    const [details, videosData, creditsData, reviewsData, similarData] = await Promise.all([
                        safeFetch(`/${type}/${id}`),
                        safeFetch(`/${type}/${id}/videos`),
                        safeFetch(`/${type}/${id}/credits`),
                        safeFetch(`/${type}/${id}/reviews`),
                        safeFetch(`/${type}/${id}/similar`)
                    ]);

                    loadingSpinner.remove();

                    // Menyimpan ID dan tipe media ke dalam state global
                    state.currentMediaId = id;
                    state.currentMediaType = type;

                    const backButton = document.createElement('button');
                    backButton.className = 'bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-full transition-colors duration-300 mb-6 flex items-center';
                    backButton.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                        </svg>
                        Back
                    `;
                    backButton.addEventListener('click', () => history.back());
                    contentArea.appendChild(backButton);

                    const director = creditsData.crew.find(member => member.job === 'Director');
                    const cast = creditsData.cast.slice(0, 5).map(actor => actor.name).join(', ');

                    const posterPath = details.poster_path;
                    const posterUrl = posterPath ? `https://image.tmdb.org/t/p/w500/${posterPath}` : 'https://placehold.co/500x750?text=No+Image';

                    let genreLinks = '';
                    if (details.genres && details.genres.length > 0) {
                        genreLinks = details.genres.map(g =>
                            `<span class="genre-link cursor-pointer text-blue-400 hover:text-blue-200 hover:underline" data-genre-id="${g.id}" data-genre-name="${g.name}">${g.name}</span>`
                        ).join(', ');
                    } else {
                        genreLinks = 'N/A';
                    }
                    
                    const trailer = videosData.results.find(video => video.type === 'Trailer' && video.site === 'YouTube');

                    // Menyiapkan HTML untuk tampilan detail dengan struktur heading yang baru
                    const detailContainer = document.createElement('div');
                    detailContainer.className = 'grid grid-cols-1 md:grid-cols-3 gap-8 md:gap-12';
                    detailContainer.innerHTML = `
                        <div class="md:col-span-1">
                            <img src="${posterUrl}" alt="Poster for ${details.title || details.name}" class="rounded-lg shadow-lg w-full">
                        </div>
                        <div class="md:col-span-2 space-y-4">
                            <h1 class="text-4xl font-extrabold text-white">${details.title || details.name}</h1>
                            ${details.tagline ? `<h2 class="text-xl italic text-gray-400 mb-4">"${details.tagline}"</h2>` : ''}

                            <h2 class="text-2xl font-bold text-white mt-8 mb-4">Film Details</h2>
                            <div class="text-lg text-gray-300 space-y-3">
                                <p class="flex items-center">
                                    <span class="mr-3 text-2xl">⭐</span>
                                    <strong class="text-white">Rating:</strong> ${details.vote_average ? details.vote_average.toFixed(1) : 'N/A'}/10 (${details.vote_count || 0} votes)
                                </p>
                                <p class="flex items-center">
                                    <span class="mr-3 text-2xl">📅</span>
                                    <strong class="text-white">Release Date:</strong> ${details.release_date || details.first_air_date || 'N/A'}
                                </p>
                                <p class="flex items-center">
                                    <span class="mr-3 text-2xl">🎭</span>
                                    <strong class="text-white">Genres:</strong> ${genreLinks}
                                </p>
                                ${director ? `
                                <p class="flex items-center">
                                    <span class="mr-3 text-2xl">🎬</span>
                                    <strong class="text-white">Director:</strong> ${director.name}
                                </p>` : ''}
                                ${cast ? `
                                <p class="flex items-start">
                                    <span class="mr-3 text-2xl">🎭</span>
                                    <span>
                                        <strong class="text-white">Actors:</strong>
                                        <br>
                                        ${cast}
                                    </span>
                                </p>` : ''}
                                <p class="flex items-center">
                                    <span class="mr-3 text-2xl">🌐</span>
                                    <strong class="text-white">Original Language:</strong> ${details.original_language ? details.original_language.toUpperCase() : 'N/A'}
                                </p>
                                ${details.homepage ? `
                                <p class="flex items-center">
                                    <span class="mr-3 text-2xl">🔗</span>
                                    <strong class="text-white">Homepage:</strong>
                                    <a href="${details.homepage}" target="_blank" class="text-blue-400 hover:text-blue-200 hover:underline ml-2">${details.homepage}</a>
                                </p>` : ''}
                            </div>
                        </div>
                    `;

                    contentArea.appendChild(detailContainer);

                    // Menambahkan bagian "Overview" sebagai h3 terpisah
                    const overviewSection = document.createElement('div');
                    overviewSection.className = 'mt-8';
                    overviewSection.innerHTML = `
                        <h3 class="text-2xl font-bold text-white mb-4">Overview</h3>
                        <p class="text-lg text-gray-300 text-justify">${details.overview || 'No overview available.'}</p>
                    `;
                    contentArea.appendChild(overviewSection);


                    // Elemen trailer mandiri, diletakkan di bawah detail film
                    if (trailer) {
                        const trailerContainer = document.createElement('div');
                        trailerContainer.className = 'mt-12 mx-auto w-full md:w-4/5 lg:w-3/4';
                        trailerContainer.innerHTML = `
                            <h3 class="text-2xl font-bold text-white mb-4 text-center">Trailer</h3>
                            <div class="relative w-full h-0 pb-[56.25%] rounded-lg overflow-hidden shadow-xl">
                                <iframe class="absolute top-0 left-0 w-full h-full" src="https://www.youtube.com/embed/${trailer.key}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                            </div>
                        `;
                        contentArea.appendChild(trailerContainer);
                    }

                    // Menambahkan bagian "Similar to this"
                    if (similarData && similarData.results && similarData.results.length > 0) {
                        const similarSection = document.createElement('div');
                        similarSection.className = 'mt-12';
                        similarSection.innerHTML = `
                            <h3 class="text-2xl font-bold text-white mb-6 text-center">Similar to this</h3>
                            <div id="similar-movies-container" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-4"></div>
                        `;
                        contentArea.appendChild(similarSection);
                        const similarMoviesContainer = document.getElementById('similar-movies-container');
                        // Render 6 film teratas yang serupa
                        renderCards(similarData.results.slice(0, 6), similarMoviesContainer);
                    }


                    // Menambahkan bagian "User Review"
                    if (reviewsData && reviewsData.results && reviewsData.results.length > 0) {
                        const reviewsSection = document.createElement('div');
                        reviewsSection.className = 'mt-12';
                        reviewsSection.innerHTML = `
                            <h3 class="text-2xl font-bold text-white mb-6 text-center">User Reviews</h3>
                            <div id="reviews-container" class="space-y-6"></div>
                        `;
                        contentArea.appendChild(reviewsSection);
                        const reviewsContainer = document.getElementById('reviews-container');

                        // Render 5 ulasan teratas
                        reviewsData.results.slice(0, 5).forEach(review => {
                            const reviewCard = document.createElement('div');
                            reviewCard.className = 'bg-gray-800 rounded-lg shadow-lg p-6';
                            reviewCard.innerHTML = `
                                <div class="flex items-center mb-4">
                                    <div class="h-12 w-12 rounded-full bg-blue-600 flex items-center justify-center text-white text-xl font-bold mr-4">
                                        ${review.author.charAt(0).toUpperCase()}
                                    </div>
                                    <div>
                                        <p class="font-bold text-white">${review.author}</p>
                                        <p class="text-sm text-gray-400">Reviewed on: ${new Date(review.created_at).toLocaleDateString()}</p>
                                    </div>
                                </div>
                                <p class="text-gray-300 text-justify line-clamp-4">${review.content}</p>
                                <button class="read-more-btn text-blue-400 hover:underline mt-2">Read More</button>
                            `;
                            reviewsContainer.appendChild(reviewCard);
                        });

                        // Add event listeners for "Read More" buttons
                        document.querySelectorAll('.read-more-btn').forEach(button => {
                            button.addEventListener('click', (e) => {
                                const reviewContent = e.target.parentNode.querySelector('p.text-gray-300');
                                reviewContent.classList.toggle('line-clamp-4');
                                e.target.textContent = reviewContent.classList.contains('line-clamp-4') ? 'Read More' : 'Show Less';
                            });
                        });

                    } else {
                        const noReviews = document.createElement('p');
                        noReviews.className = 'mt-12 text-center text-gray-500';
                        noReviews.textContent = 'No user reviews available yet.';
                        contentArea.appendChild(noReviews);
                    }

                    // Menambahkan tombol "Stream Now" di bawah ulasan
                    const streamingNowButton = document.createElement('div'); // Mengubah menjadi div untuk menampung tombol
                    streamingNowButton.className = 'mt-8 flex justify-center';
                    streamingNowButton.innerHTML = `
                        <button id="trigger-streaming-view-button" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-full transition-colors duration-300 shadow-lg transform hover:scale-105">
                            Stream Now
                        </button>
                    `;
                    contentArea.appendChild(streamingNowButton);


                    // Menambahkan event listener untuk link genre
                    document.querySelectorAll('.genre-link').forEach(link => {
                        link.addEventListener('click', (e) => {
                            e.preventDefault();
                            const genreId = e.target.dataset.genreId;
                            const genreName = e.target.dataset.genreName;
                            // Memperbarui hash URL untuk memicu tampilan daftar genre
                            window.location.hash = `content/${type}/genre/${genreId}/${encodeURIComponent(genreName)}`;
                        });
                    });

                    // Menambahkan event listener untuk tombol "Stream Now" yang baru (untuk mengaktifkan tampilan streaming)
                    document.getElementById('trigger-streaming-view-button').addEventListener('click', async () => {
                        updateState({ currentView: 'streaming' });
                        streamingPageTitle.textContent = `Streaming: ${details.title || details.name}`;
                        // Hapus pemanggilan streamingPlayerInline.src di sini
                        // streamingPlayerInline.src = `https://vidsrc.me/embed/${state.currentMediaId}`; // Dihapus

                        // Memuat film-film serupa (genre romantis) di dalam bagian inline
                        // Menggunakan genre yang relevan dengan film yang sedang ditonton, atau fallback ke romantis jika tidak ada
                        const romanceGenreId = 10749; // ID untuk genre Romance
                        const similarInlineMovies = await fetchByGenre(type, romanceGenreId, 1); // Selalu ambil Romance
                        if (similarInlineMovies && similarInlineMovies.length > 0) {
                            renderSimpleCards(similarInlineMovies.slice(0, 12), inlineSimilarContainer);
                        } else {
                            inlineSimilarContainer.innerHTML = '<p class="text-center text-gray-500 col-span-full">No similar content found.</p>';
                        }
                    });

                } catch (error) {
                    console.error('Failed to fetch details:', error);
                    loadingSpinner.remove();
                    contentArea.innerHTML = '<p class="text-center text-red-500">Failed to load details. Please try again later.</p>';
                }
            };
            
            const handleUrlHash = () => {
                const hash = window.location.hash.slice(1);
                if (!hash) {
                    updateState({ currentView: 'home', listParams: null, detailsParams: null, searchQuery: null, currentPage: 1 });
                    return;
                }
                const parts = hash.split('/');
                const view = parts[0];

                switch (view) {
                    case 'content':
                        if (parts.length > 3) {
                            const [_, type, fetchType, id, title] = parts;
                            const titleDecoded = decodeURIComponent(title);
                            updateState({
                                currentView: 'list',
                                listParams: { fetchType, type, id, title: titleDecoded },
                                detailsParams: null,
                                searchQuery: null,
                                currentPage: 1
                            });
                        }
                        break;
                    case 'details':
                        if (parts.length > 3) {
                            const [_, type, id, title] = parts;
                            const titleDecoded = decodeURIComponent(title);
                            updateState({
                                currentView: 'details',
                                detailsParams: { type, id, title: titleDecoded },
                                listParams: null,
                                searchQuery: null
                            });
                        }
                        break;
                    case 'search':
                        if (parts.length > 1) {
                            const [_, query] = parts;
                            const queryDecoded = decodeURIComponent(query);
                            updateState({
                                currentView: 'search',
                                searchQuery: queryDecoded,
                                listParams: null,
                                detailsParams: null
                            });
                        }
                        break;
                    default:
                        updateState({ currentView: 'home', listParams: null, detailsParams: null, searchQuery: null });
                        break;
                }
            };

            // Event Listeners
            searchForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const query = searchInput.value.trim();
                if (query) {
                    window.location.hash = `search/${encodeURIComponent(query)}`;
                    searchInput.value = ''; // Clear search input after submission
                }
            });

            // Dropdown menu handling
            const closeDropdowns = () => {
                moviesDropdownMenu.classList.remove('opacity-100', 'visible');
                moviesDropdownMenu.classList.add('opacity-0', 'invisible');
                tvShowsDropdownMenu.classList.remove('opacity-100', 'visible');
                tvShowsDropdownMenu.classList.add('opacity-0', 'invisible');
            };

            moviesDropdownButton.addEventListener('click', (e) => {
                e.stopPropagation(); // Prevent document click from closing immediately
                closeDropdowns(); // Close other dropdowns
                moviesDropdownMenu.classList.toggle('opacity-0');
                moviesDropdownMenu.classList.toggle('invisible');
                moviesDropdownMenu.classList.toggle('opacity-100');
                moviesDropdownMenu.classList.toggle('visible');
            });

            tvShowsDropdownButton.addEventListener('click', (e) => {
                e.stopPropagation(); // Prevent document click from closing immediately
                closeDropdowns(); // Close other dropdowns
                tvShowsDropdownMenu.classList.toggle('opacity-0');
                tvShowsDropdownMenu.classList.toggle('invisible');
                tvShowsDropdownMenu.classList.toggle('opacity-100');
                tvShowsDropdownMenu.classList.toggle('visible');
            });

            document.addEventListener('click', (e) => {
                // Close dropdowns if click is outside
                if (!moviesDropdownButton.contains(e.target) && !moviesDropdownMenu.contains(e.target)) {
                    moviesDropdownMenu.classList.remove('opacity-100', 'visible');
                    moviesDropdownMenu.classList.add('opacity-0', 'invisible');
                }
                if (!tvShowsDropdownButton.contains(e.target) && !tvShowsDropdownMenu.contains(e.target)) {
                    tvShowsDropdownMenu.classList.remove('opacity-100', 'visible');
                    tvShowsDropdownMenu.classList.add('opacity-0', 'invisible');
                }
            });


            document.querySelectorAll('#movies-dropdown-menu button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const type = e.target.dataset.type;
                    const category = e.target.dataset.category;
                    const title = `${e.target.textContent} Movies`;
                    window.location.hash = `content/${type}/category/${category}/${encodeURIComponent(title)}`;
                    closeDropdowns(); // Close dropdown after selection
                });
            });

            document.querySelectorAll('#tv-shows-dropdown-menu button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const type = e.target.dataset.type;
                    const category = e.target.dataset.category;
                    const title = `${e.target.textContent} Tv Shows`;
                    window.location.hash = `content/${type}/category/${category}/${encodeURIComponent(title)}`;
                    closeDropdowns(); // Close dropdown after selection
                });
            });
            
            // Initial load based on hash
            if (!window.location.hash || window.location.hash === '#home') {
                updateState({ currentView: 'home' });
            } else {
                handleUrlHash();
            }
            
            window.addEventListener('hashchange', handleUrlHash);
            homeLink.addEventListener('click', () => {
                window.location.hash = '';
            });

            // Event listener untuk tombol stream inline (sekarang di dalam streaming-page-view)
            stream1InlineButton.addEventListener('click', () => {
                if (state.currentMediaId) {
                    streamingPlayerInline.src = `https://vidsrc.me/embed/${state.currentMediaId}`;
                }
            });

            stream2InlineButton.addEventListener('click', () => {
                if (state.currentMediaId && state.currentMediaType) {
                    streamingPlayerInline.src = `https://vidsrc.to/embed/${state.currentMediaType}/${state.currentMediaId}`;
                }
            });

            // Tombol kembali untuk tampilan streaming
            streamingBackButton.addEventListener('click', () => {
                streamingPlayerInline.src = ''; // Hentikan video saat kembali
                history.back(); // Kembali ke hash sebelumnya (halaman detail)
            });
        });
    </script>
</body>
</html>